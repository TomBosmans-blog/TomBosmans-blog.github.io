import{_ as n,c as s,o as a,a as e}from"./app.ead78b55.js";const b='{"title":"Add Json Synonyms Mime Types in Rails","description":"","frontmatter":{"sidebar":false},"headers":[],"relativePath":"articles/2020-03-19-add-json-synonyms-mime-types-in-rails.md","lastUpdated":null}',p={},o=e(`<h1 id="add-json-synonyms-mime-types-in-rails" tabindex="-1">Add Json Synonyms Mime Types in Rails <a class="header-anchor" href="#add-json-synonyms-mime-types-in-rails" aria-hidden="true">#</a></h1><p>A spec like <a href="https://jsonapi.org/format/#content-negotiation-servers" target="_blank" rel="noopener noreferrer">JSON:API</a> wants us to accept Content-Type <code>application/vnd.api+json</code>. To make this work we need to register a <a href="https://api.rubyonrails.org/" target="_blank" rel="noopener noreferrer">Mime::Type</a>.</p><p>Of course in case of <code>application/vnd.api+json</code> we want this to work as if it was the standard <code>application/json</code> so preferably we make this a synonym. If we take a look at the existing <code>Mime::Type</code>:</p><div class="language-bash line-numbers-mode"><pre><code><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> pry<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">&gt;</span> Mime::Type.lookup<span class="token punctuation">(</span><span class="token string">&#39;application/json&#39;</span><span class="token punctuation">)</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">#&lt;Mime::Type:0x00007fd9c7f6d530</span>
 @hash<span class="token operator">=</span>-727503365037717188,
 @string<span class="token operator">=</span><span class="token string">&quot;application/json&quot;</span>,
 @symbol<span class="token operator">=</span>:json,
 @synonyms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;text/x-json&quot;</span>, <span class="token string">&quot;application/jsonrequest&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>We can see there are already synonyms, so how do we add a new one without overriding the existing ones?</p><div class="language-ruby line-numbers-mode"><pre><code><span class="token comment"># config/initializers/mime_type.rb</span>
json_synonyms <span class="token operator">=</span> Mime<span class="token double-colon punctuation">::</span>Type<span class="token punctuation">.</span>lookup<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;application/json&#39;</span></span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token symbol">:synonyms</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;application/vnd.api+json&#39;</span></span><span class="token punctuation">)</span>
Mime<span class="token double-colon punctuation">::</span>Type<span class="token punctuation">.</span>register <span class="token string-literal"><span class="token string">&#39;application/json&#39;</span></span><span class="token punctuation">,</span> <span class="token symbol">:json</span><span class="token punctuation">,</span> json_synonyms
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Sadly we need to use <a href="https://ruby-doc.org/core-2.7.0/Object.html#method-i-send" target="_blank" rel="noopener noreferrer">send</a> to gain access to a private method, but this is still better than overriding all synonyms.</p><p>If we now lookup our new MIME type:</p><div class="language-bash line-numbers-mode"><pre><code><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> pry<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">&gt;</span> Mime::Type.lookup<span class="token punctuation">(</span><span class="token string">&#39;application/vnd.api+json&#39;</span><span class="token punctuation">)</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">#&lt;Mime::Type:0x00007fd9c7f6d530</span>
 @hash<span class="token operator">=</span>-727503365037717188,
 @string<span class="token operator">=</span><span class="token string">&quot;application/json&quot;</span>,
 @symbol<span class="token operator">=</span>:json,
 @synonyms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;text/x-json&quot;</span>, <span class="token string">&quot;application/jsonrequest&quot;</span>, <span class="token string">&quot;application/vnd.api+json&quot;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,9),t=[o];function i(r,c,l,u,d,m){return a(),s("div",null,t)}var y=n(p,[["render",i]]);export{b as __pageData,y as default};
